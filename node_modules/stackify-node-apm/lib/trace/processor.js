'use strict'

const TraceLogger = require('./trace-logger')
const TraceFormatter = require('./formatter')

/**
 * Handles processing of ended transactions
 * @constructor
 */
function TraceProcessor () {
  this._traceFormatter = new TraceFormatter()
  this._traceLogger = new TraceLogger()
}

/**
 * Process ended transactions (formatting/logging) - synchronously
 * @param transactions
 */
TraceProcessor.prototype.process = function (transactions) {
  for (let i = 0; i < transactions.length; i++) {
    let transaction = transactions[i]
    if (transaction.isLoggedState()) {
      continue // FIXME: Do nothing?
    }
    let json = this._traceFormatter.formatTransaction(transaction)

    this._traceLogger.log(json)
    transaction.setStateLogged() // Add transaction as logged
  }
}

module.exports = TraceProcessor
